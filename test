_G.FastAttackEnabled = true

-- ===== Services =====
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local Player = Players.LocalPlayer
local Character = Player.Character or Player.CharacterAdded:Wait()

local Enemies = workspace:WaitForChild("Enemies")

local Net = ReplicatedStorage:WaitForChild("Modules"):WaitForChild("Net")
local RegisterAttack = Net:WaitForChild("RE/RegisterAttack")
local RegisterHit = Net:WaitForChild("RE/RegisterHit")

-- ===== ÂèÉÊï∏ÔºàÊåÅÁ∫åËº∏Âá∫Ê†∏ÂøÉÔºâ=====
local SCAN_RANGE = 850            -- ÊâæÊïµ‰∫∫Áî®
local HIT_RANGE = 420             -- ÁúüÂØ¶ÂëΩ‰∏≠Ë∑ùÈõ¢
local HITBOX_SIZE = Vector3.new(420,420,420)

local BASE_INTERVAL = 0.045       -- Âü∫Á§éÊîªÈÄü
local MIN_INTERVAL = 0.02         -- ÊúÄÂø´‰∏äÈôê
local MAX_TARGETS_SPEEDUP = 6     -- ÂπæÈöªÊÄ™ÊôÇÈÅîÂà∞ÊúÄÂø´

-- ===== Â∑•ÂÖ∑ =====
local function Alive(char)
    local hum = char and char:FindFirstChildOfClass("Humanoid")
    return hum and hum.Health > 0
end

local function GetPart(enemy)
    return enemy:FindFirstChild("HumanoidRootPart") or enemy:FindFirstChild("Head")
end

-- ===== ÂÅΩË£ù HitboxÔºàÁû¨ÊôÇÔºâ=====
local HRP
local ORIGINAL_SIZE

local function ExpandHRP()
    HRP = Character:FindFirstChild("HumanoidRootPart")
    if not HRP then return end
    ORIGINAL_SIZE = ORIGINAL_SIZE or HRP.Size

    HRP.Size = HITBOX_SIZE
    HRP.Transparency = 1
    HRP.LocalTransparencyModifier = 1
    HRP.CanCollide = false
end

local function RestoreHRP()
    if HRP and ORIGINAL_SIZE then
        HRP.Size = ORIGINAL_SIZE
    end
end

-- ===== Êî∂ÈõÜÂèØÂëΩ‰∏≠ÁõÆÊ®ô =====
local function CollectTargets()
    local targets = {}
    local basePart
    local myRoot = Character:FindFirstChild("HumanoidRootPart")
    if not myRoot then return nil, targets end

    for _, enemy in ipairs(Enemies:GetChildren()) do
        if enemy ~= Character and Alive(enemy) then
            local part = GetPart(enemy)
            if part then
                local dist = (part.Position - myRoot.Position).Magnitude
                if dist <= HIT_RANGE then
                    targets[#targets+1] = {enemy, part}
                    basePart = basePart or part
                end
            end
        end
    end

    return basePart, targets
end

-- ===== ÊåÅÁ∫åËº∏Âá∫‰∏ªÂæ™Áí∞ =====
local lastAttack = 0

RunService.RenderStepped:Connect(function()
    if not _G.FastAttackEnabled then return end

    local basePart, targets = CollectTargets()
    if not basePart or #targets == 0 then return end

    -- ÁõÆÊ®ôË∂äÂ§öÔºåÊîªÈÄüË∂äÂø´Ôºà‰ΩÜÊúâ‰∏äÈôêÔºâ
    local speedFactor = math.clamp(#targets / MAX_TARGETS_SPEEDUP, 0, 1)
    local interval = BASE_INTERVAL - (BASE_INTERVAL - MIN_INTERVAL) * speedFactor

    if os.clock() - lastAttack < interval then return end
    lastAttack = os.clock()

    ExpandHRP()
    RegisterAttack:FireServer(0)
    RegisterHit:FireServer(basePart, targets)
    RestoreHRP()
end)

-- ===== ÈáçÁîüËôïÁêÜ =====
Player.CharacterAdded:Connect(function(c)
    Character = c
    ORIGINAL_SIZE = nil
end)

print("üî• ÊåÅÁ∫åËº∏Âá∫Áâà FastAttack Â∑≤ÂïüÂãïÔºàÁ©©ÂÆöÈÄ£Á†çÔºâ")
